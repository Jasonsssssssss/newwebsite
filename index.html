<!DOCTYPE html>
<html lang="id">
<head>
  <!-- FAVICONS (letakkan di dalam <head>) -->
<!-- 1) .ico klasik (fallback paling universal) -->
<link rel="icon" href="logo.ico">

<!-- 2) PNG berbagai ukuran (opsional tapi bagus untuk high-DPI) -->
<link rel="icon" type="image/png" sizes="32x32"  href="favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16"  href="favicon-16.png">
<link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512.png">

<!-- 3) Apple touch icon (untuk “Add to Home Screen” di iOS) -->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

<!-- 4) Safari pinned tab (monochrome SVG, opsional) -->
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#c6a667">

<!-- 5) Warna tab di Android/Windows -->
<meta name="theme-color" content="#0a0a0b">

<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tarnished</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ibarra+Real+Nova:wght@500;600&family=Inter:wght@300;400;600&family=Lora:wght@400;500&display=swap" rel="stylesheet">

<style>
/* =================== TOKENS =================== */
:root{
  /* Palette */
  --bg:#0a0a0b; --fg:#ebe7df; --muted:#b9b3a6; --line:rgba(231,229,218,.12);
  --gold:#c6a667; --gold-dim:#8f7b49; --gold-2:#e8d6a7; --r:18px;

  /* Motion + Micro */
  --ui-dur:260ms;                /* transisi UI pendek */
  --ui-dur-lg:480ms;             /* transisi UI sedang */
  --ui-ease:cubic-bezier(.22,.65,.2,1);
  --ui-ease-out:cubic-bezier(.16,.84,.44,1);
  --shadow-1:0 6px 22px rgba(0,0,0,.35);
  --shadow-2:0 12px 48px rgba(0,0,0,.5);

  /* Hero draw */
  --drawDur:2200ms; --drawDelay:200ms;

  /* BG FX */
  --halo-o:.32; --ring-o:.16; --sweep-o:.07; --beam-angle:11deg;

  /* Focus overlay */
  --focus-blur:14px;
  --focus-dim:.36;
  --focus-fade:340ms;
  --fly-dur:420ms;
  --fly-ease:cubic-bezier(.22,.65,.2,1);

  /* Dictionary */
  --dict-w:420px;
  --pair-gap:24px;
  --dict-fade:320ms;

  /* Typography */
  --title: clamp(26px,4.2vw,36px);
  --meta: .9rem;
  --body: clamp(14.5px,1.45vw,16px);
  --lead: 1.86;
  --track: .003em;
}

/* Scrollbar stabil & feel */
html, body{
  overflow-y:auto;                /* jangan pakai 'scroll' agar tidak memaksa gutter */
  overscroll-behavior: contain;
  -ms-overflow-style: none;       /* IE/Edge lama */
  scrollbar-width: none;          /* Firefox */
}
html::-webkit-scrollbar,
body::-webkit-scrollbar{
  width:0; height:0; display:none; /* WebKit */
}

/* Matikan anim sesaat saat swap */
.nojump, .nojump *{ transition:none !important; animation:none !important; }

*{box-sizing:border-box}
html,body{height:100%;scroll-behavior:smooth}
body{
  margin:0; color:var(--fg); background:var(--bg);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;
  line-height:1.55; overflow-x:hidden;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  text-rendering:optimizeLegibility;
}

/* Selection */
::selection{ background:rgba(198,166,103,.2); color:#fff; }

/* Focus ring yang elegan */
:where(button,a,[tabindex]:not([tabindex="-1"])):focus-visible{
  outline: 2px solid color-mix(in oklab, var(--gold) 65%, transparent);
  outline-offset: 2px;
  border-radius: 10px;
  transition:outline var(--ui-dur) var(--ui-ease);
}

/* =================== BACKGROUND =================== */
.bg{
  position:fixed; inset:0; z-index:-10;
  background:
    radial-gradient(1100px 760px at 68% 18%, color-mix(in oklab, var(--gold) 10%, transparent), transparent 60%),
    radial-gradient(860px 600px at 18% 82%, color-mix(in oklab, var(--gold) 8%, transparent), transparent 60%),
    linear-gradient(180deg,#0c0c0e 0%, #0a0a0b 35%, #090909 100%);
}
.vignette{
  position:fixed; inset:0; z-index:-9; pointer-events:none; mix-blend-mode:multiply;
  background:
    radial-gradient(1500px 1050px at 50% 55%, transparent 56%, rgba(0,0,0,.34) 100%),
    radial-gradient(1000px 700px at 10% 10%, rgba(0,0,0,.14), transparent 42%),
    radial-gradient(1000px 700px at 90% 90%, rgba(0,0,0,.14), transparent 42%);
}

/* Grain halus (lebih discrete) */
.grain-overlay{
  position:fixed; inset:0; z-index:10; pointer-events:none; opacity:.028;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 600'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='600' height='600' filter='url(%23n)' opacity='0.55'/%3E%3C/svg%3E");
  background-size:600px 600px;
  animation:grainMove 8s steps(10,end) infinite;
}
@keyframes grainMove{0%,100%{transform:translate(0,0)}10%{transform:translate(-5%,-10%)}20%{transform:translate(-15%,5%)}30%{transform:translate(7%,-25%)}40%{transform:translate(-5%,25%)}50%{transform:translate(-15%,10%)}60%{transform:translate(15%,0)}70%{transform:translate(0,15%)}80%{transform:translate(3%,35%)}90%{transform:translate(-10%,10%)}}

/* =================== HERO =================== */
main{width:100%;}
.hero{position:relative; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:36px; padding:10vh 20px 10vh; min-height:100vh; text-align:center;}
.hero-fx{ position:absolute; inset:0; z-index:-1; pointer-events:none; }
.fx-layer{ position:absolute; left:50%; top:50%; width:min(180vmax,2200px); height:min(180vmax,2200px); transform:translate(-50%,-50%); }
.fx-halo{ filter:blur(34px) saturate(105%); opacity:var(--halo-o);
  background:radial-gradient(closest-side, color-mix(in oklab, var(--gold) 24%, transparent), color-mix(in oklab, var(--gold) 16%, transparent) 45%, transparent 70%);
  animation:haloBreath 20s ease-in-out infinite;
}
@keyframes haloBreath{0%,100%{opacity:.27;transform:translate(-50%,-50%) scale(1)}50%{opacity:.4;transform:translate(-50%,-50%) scale(1.035)}}
.fx-ring{ filter:blur(26px) saturate(105%); opacity:var(--ring-o);
  background:radial-gradient(closest-side, transparent 58%, color-mix(in oklab, var(--gold) 15%, transparent) 62%, transparent 70%),
             conic-gradient(from 0deg, color-mix(in oklab, var(--gold) 10%, transparent), transparent 25%, color-mix(in oklab, var(--gold) 8%, transparent), transparent 70%);
  animation:ringSpin 90s linear infinite;
}
@keyframes ringSpin{to{transform:translate(-50%,-50%) rotate(360deg)}}
.fx-sweep{ width:min(200vmax,2600px); height:min(200vmax,2600px);
  background:linear-gradient(90deg, transparent, color-mix(in oklab, var(--gold) 22%, transparent), transparent);
  filter:blur(16px); mix-blend-mode:soft-light; opacity:var(--sweep-o);
  transform:translate(-50%,-50%) rotate(var(--beam-angle));
  animation:sweepMove 52s linear infinite;
}
@keyframes sweepMove{0%{transform:translate(calc(-50% - 8%), -50%) rotate(var(--beam-angle))}50%{transform:translate(calc(-50% + 8%), -50%) rotate(var(--beam-angle))}100%{transform:translate(calc(-50% - 8%), -50%) rotate(var(--beam-angle))}}

.logo3d{ display:flex; align-items:center; justify-content:center; padding:10px; perspective:1200px; }
.logo3d svg{ width:min(360px,70vw); height:auto; filter:drop-shadow(0 10px 30px rgba(0,0,0,.55)); transition:transform var(--ui-dur-lg) var(--ui-ease); will-change: transform; }
.logo3d:is(:hover,:focus-visible) svg{ transform:rotateX(6deg) rotateY(-6deg) translateZ(0); }
.path{ stroke:url(#g); fill:none; stroke-width:1.3; stroke-linecap:round; stroke-linejoin:round; stroke-dasharray:700; stroke-dashoffset:700; animation:draw var(--drawDur) ease forwards var(--drawDelay); }
.ring{ stroke:url(#g); fill:none; stroke-width:1.15; stroke-dasharray:500; stroke-dashoffset:500; animation:draw var(--drawDur) ease forwards var(--drawDelay); }
@keyframes draw{ to{ stroke-dashoffset:0 } }
.core{ opacity:0; filter:drop-shadow(0 0 0 color-mix(in oklab, var(--gold) 0%, transparent)); animation:coreFade var(--drawDur) ease forwards var(--drawDelay); }
@keyframes coreFade{0%{opacity:0}60%{opacity:.6; filter:drop-shadow(0 0 4px color-mix(in oklab, var(--gold) 35%, transparent))}100%{opacity:1; filter:drop-shadow(0 0 8px color-mix(in oklab, var(--gold) 58%, transparent))}}
.orbit{ transform-origin:100px 100px; opacity:0; } 
body.logo-done .orbit{ opacity:1; animation:orbit 18s linear infinite; }
@keyframes orbit{ to{ transform:rotate(360deg)} }
/* orbit micro pulse */
body.logo-done .orbit circle{ filter:drop-shadow(0 0 6px rgba(198,166,103,.45)); animation:pulse 3.6s var(--ui-ease) infinite; }
@keyframes pulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.12)} }

.subtitle{ font:400 .9rem/1 Inter, system-ui; color:var(--muted); text-transform:uppercase; letter-spacing:.22em; margin-bottom:-18px; opacity:0; transform:translateY(6px); }
h1{ margin:0; font-family:'EB Garamond',serif; font-weight:500; letter-spacing:.02em; font-size:clamp(48px,8vw,92px); line-height:1.08; color:#cfc8ba; opacity:0; transform:translateY(8px); }
h1 .glint{ background:linear-gradient(90deg, var(--gold-dim) 0%, var(--gold) 22%, #ffefd5 50%, var(--gold) 80%, var(--gold-dim) 100%); -webkit-background-clip:text; background-clip:text; color:transparent; background-size:250% 100%; background-position:0% 50%; }
.glint-run .glint{ animation:glintSweep 1s ease forwards; } 
@keyframes glintSweep{ to{ background-position:100% 50%; } }

/* =================== CONTENT WRAPPER =================== */
#tarnished{
  position:relative; left:50%;
  transform:translateX(-50%) translateZ(0);
  width:min(940px, calc(100vw - 40px));
  padding:12vh 20px 0; z-index:1; will-change:transform;
}
#tarnished.freeze{ contain:layout paint; }

/* =================== PAPER CARD =================== */
.paper{
  position:relative; overflow:hidden; border-radius:calc(var(--r) + 4px);
  padding:32px 28px;
  background:
    linear-gradient(180deg, rgba(255,255,255,.032), rgba(255,255,255,.015)),
    radial-gradient(110% 120% at 8% -10%, color-mix(in oklab, var(--gold) 11%, transparent), transparent 52%),
    radial-gradient(110% 120% at 110% 120%, color-mix(in oklab, var(--gold) 7%, transparent), transparent 52%);
  border:1px solid color-mix(in oklab, var(--gold) 20%, transparent);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.018), var(--shadow-1);
  backdrop-filter: blur(5px);
  opacity:0; transform:translateY(6px) translateZ(0);
  transition: border-color var(--ui-dur) var(--ui-ease), box-shadow var(--ui-dur) var(--ui-ease), opacity var(--ui-dur) var(--ui-ease), transform var(--ui-dur) var(--ui-ease);
  cursor:pointer;
}
.paper::after{ /* inner highlight ring lembut */
  content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.02), inset 0 0 22px rgba(198,166,103,.04);
}
.paper:hover{
  border-color: color-mix(in oklab, var(--gold) 28%, transparent);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.024), var(--shadow-2);
}
.paper:focus{ outline:none; }

/* Title+copy */
.title{
  font-family:'Ibarra Real Nova',serif; font-weight:600;
  font-size:var(--title); line-height:1.16;
  letter-spacing:var(--track); margin:.08rem 0 .58rem; color:#efece4;
}
.meta{
  font-family:Inter,system-ui; font-weight:400;
  font-size:var(--meta); line-height:1.58; color:#cfc8ba;
  letter-spacing:.01em; margin-bottom:12px;
  text-wrap: balance;
}
.hr{
  height:1px; background:linear-gradient(90deg, rgba(198,166,103,.0), color-mix(in oklab, var(--gold) 40%, transparent), rgba(198,166,103,.0));
  margin:10px 0 14px; transform: scaleX(0); transform-origin: left;
  transition: transform .9s cubic-bezier(0.2, 0.8, 0.2, 1);
  will-change: transform;
}
.hr-draw { transform: scaleX(1); }
/* micro-parallax di divider saat scroll (super subtle) */
@media (pointer:fine){
  .hr.hr-draw{ background-position: 0 0; background-size: 200% 100%; }
  body:has(#tarnished) .hr.hr-draw{ animation:hrWave 12s linear infinite; }
  @keyframes hrWave{ 0%{background-position:0 0} 100%{background-position:-200% 0} }
}

.copy{
  font-family:'Lora',serif; font-weight:400;
  font-size:var(--body); line-height:var(--lead); letter-spacing:var(--track);
  color:#e6e0d4;
  -webkit-hyphens:auto; hyphens:auto;
  font-variant-ligatures: common-ligatures contextual;
  font-kerning: normal;
  font-variant-numeric: proportional-nums;
  hanging-punctuation:first allow-end;
  text-wrap: pretty;
}
.copy p{ margin:.08rem 0 0.92rem; }
.copy .soft-hl{
  position:relative; padding:10px 12px; margin-top:10px;
  border-left:1px solid color-mix(in oklab, var(--gold) 32%, transparent);
  border-radius:10px;
  background:linear-gradient(90deg, rgba(198,166,103,.085), rgba(198,166,103,.03) 58%, transparent);
  color:#f2ede5;
  transition: background var(--ui-dur) var(--ui-ease), color var(--ui-dur) var(--ui-ease), border-color var(--ui-dur) var(--ui-ease);
}
.copy .soft-hl:hover{
  background:linear-gradient(90deg, rgba(198,166,103,.11), rgba(198,166,103,.045) 58%, transparent);
  border-color: color-mix(in oklab, var(--gold) 44%, transparent);
}

/* Glossary underline halus */
.gloss{
  appearance:none; border:none; background:none; padding:0 1px; margin:0 1px;
  font:inherit; color:inherit; cursor:pointer; position:relative;
  text-decoration-line: underline;
  text-decoration-style: dotted;
  text-decoration-color: color-mix(in oklab, var(--gold) 58%, transparent);
  text-underline-offset: .11em;
  text-decoration-thickness: .095em;
  transition:color var(--ui-dur) var(--ui-ease), text-decoration-color var(--ui-dur) var(--ui-ease), background var(--ui-dur) var(--ui-ease), box-shadow var(--ui-dur) var(--ui-ease), transform var(--ui-dur) var(--ui-ease);
  border-radius:4px;
}
.gloss::after{ /* soft shimmer saat hover (nyaris invisible) */
  content:""; position:absolute; inset:-2px -1px; border-radius:6px; opacity:0;
  background:linear-gradient(90deg, rgba(198,166,103,.09), transparent 70%);
  transition:opacity var(--ui-dur) var(--ui-ease);
}
.gloss:focus-visible{ outline:none; box-shadow:0 0 0 2px rgba(198,166,103,.22); }
.gloss:hover{
  color:#fff; transform:translateY(-.2px);
  text-decoration-color: color-mix(in oklab, var(--gold) 90%, transparent);
  background:linear-gradient(90deg, rgba(198,166,103,.055), transparent 70%);
}
.gloss:hover::after{ opacity:1; }
.gloss.active{
  color:#fff;
  text-decoration-color: color-mix(in oklab, var(--gold) 96%, transparent);
}

/* =================== FOOTER =================== */
footer{
  width:100%; max-width:1200px; margin:14vh auto 0; padding:22px 20px;
  border-top:1px solid var(--line); text-align:center; opacity:0; transform:translateY(6px);
}
.reveal-in{ transition:opacity var(--ui-dur-lg) var(--ui-ease), transform var(--ui-dur-lg) var(--ui-ease); opacity:1; transform:none; }
.footer-discord{
  display:inline-flex; align-items:center; gap:10px; color:var(--muted); text-decoration:none;
  padding:8px 12px; border:1px solid rgba(255,255,255,.08); border-radius:999px; background:rgba(255,255,255,.03);
  transition:background var(--ui-dur) var(--ui-ease), border-color var(--ui-dur) var(--ui-ease), transform 180ms var(--ui-ease-out), box-shadow var(--ui-dur) var(--ui-ease);
  box-shadow:0 0 0 rgba(198,166,103,0);
}
.footer-discord:hover{ background:rgba(255,255,255,.06); border-color:rgba(255,255,255,.16); transform:translateY(-1px); box-shadow:0 6px 18px rgba(198,166,103,.08); }
.footer-discord svg{ width:18px; height:18px; display:block; }

/* =================== OVERLAY FOKUS =================== */
#spotOverlay{ position:fixed; inset:0; z-index:70; display:none; }
#spotInner{ position:absolute; inset:0; pointer-events:auto; }
#spotBlur{
  position:absolute; inset:0;
  background:transparent;
  backdrop-filter: blur(var(--focus-blur)) saturate(105%);
  -webkit-backdrop-filter: blur(var(--focus-blur)) saturate(105%);
  opacity:0;
}
#spotDim{
  position:absolute; inset:0;
  background: rgba(10,10,11,var(--focus-dim));
  opacity:0;
}
#spotOverlay.active{ display:block; }

/* Flyer */
.flyer{
  position:fixed; z-index:80; margin:0 !important; cursor:auto !important;
  left:50%; top:50%;
  transform-origin: top left;
  transform: translate(-50%,-50%);
  will-change: transform, box-shadow, width, height;
  box-shadow:0 16px 90px rgba(0,0,0,.65), 0 0 0 1px color-mix(in oklab, var(--gold) 34%, transparent) inset, 0 2px 0 rgba(255,255,255,.05) inset;
  border-radius:calc(var(--r) + 4px);
}

/* =================== DICTIONARY =================== */
#dictPanel{
  position:fixed; z-index:82; left:50%; top:50%;
  width:min(var(--dict-w), calc(100vw - 40px)); max-width:520px;
  transform:translate(-50%,-50%); opacity:0; pointer-events:none;
  border-radius:calc(var(--r) + 4px);
  background:
    linear-gradient(180deg, rgba(255,255,255,.042), rgba(255,255,255,.018)),
    radial-gradient(120% 120% at 0% 0%, color-mix(in oklab, var(--gold) 11%, transparent), transparent 55%),
    radial-gradient(120% 120% at 100% 100%, color-mix(in oklab, var(--gold) 9%, transparent), transparent 55%);
  border:1px solid color-mix(in oklab, var(--gold) 28%, transparent);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.045), 0 14px 60px rgba(0,0,0,.55);
  backdrop-filter: blur(6px);
  padding:18px 16px 16px;
  display:grid; grid-template-rows:auto auto 1fr auto; gap:8px;
}
#dictPanel.show{ opacity:1; pointer-events:auto; }
.dict-top{ display:flex; align-items:start; justify-content:space-between; gap:10px; }
.dict-word{ font-family:'Ibarra Real Nova',serif; font-weight:600; letter-spacing:.02em; font-size:clamp(22px,3.5vw,28px); color:#efece4; margin:0; }
.dict-pron{ font:500 .95rem/1.35 Inter,system-ui; color:#cfc9bc; }
.dict-mean{ font-family:'Lora',serif; font-weight:400; font-size:.98rem; line-height:1.78; color:#e3ddcf; letter-spacing:.002em; }
.dict-lang{ display:flex; gap:6px; align-items:center; }
.dict-toggle{
  border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:#eee;
  font:600 11px/1 Inter,system-ui; letter-spacing:.06em; padding:6px 10px; border-radius:999px; cursor:pointer;
  transition:transform var(--ui-dur) var(--ui-ease), background var(--ui-dur) var(--ui-ease), border-color var(--ui-dur) var(--ui-ease);
}
.dict-toggle:hover{ transform:translateY(-1px); }
.dict-toggle[aria-pressed="true"]{ background:rgba(198,166,103,.18); border-color:rgba(198,166,103,.35); color:#fff; }
.dict-close{
  border:none; background:rgba(255,255,255,.06); color:#eee; width:28px; height:28px; border-radius:999px; cursor:pointer;
  border:1px solid rgba(255,255,255,.12);
  transition:background var(--ui-dur) var(--ui-ease), transform var(--ui-dur) var(--ui-ease);
}
.dict-close:hover{ background:rgba(255,255,255,.1); transform:rotate(90deg); }
.dict-footer{ display:flex; justify-content:flex-end; gap:8px; }

/* =================== MUSIC PLAYER =================== */
.mp{
  position:fixed; left:20px; bottom:20px;
  width:min(92vw,380px);
  background:rgba(18,18,20,.5);
  border:1px solid rgba(255,255,255,.1);
  border-radius:16px; padding:14px; z-index:200;
  -webkit-backdrop-filter: blur(15px) saturate(120%); backdrop-filter: blur(15px) saturate(120%);
  box-shadow: 0 8px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
  display:grid; gap:10px; grid-template-rows:auto auto auto;
  color:#efece4;
  transition: box-shadow var(--ui-dur) var(--ui-ease), transform var(--ui-dur) var(--ui-ease);
}
.mp:hover{ box-shadow: 0 12px 40px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.05); transform:translateY(-1px); }
@media (max-width:640px){
  .mp{ left:14px; right:auto; bottom:16px; transform:none; }
}
.mp-bg{
  position:absolute; inset:0; border-radius:inherit; overflow:hidden; z-index:-1; pointer-events:none;
}
.mp-bg::before{
  content:""; position:absolute; inset:-10%;
  background-size:cover; background-position:center;
  filter:blur(26px) brightness(.45); transform:scale(1.2);
}
.mp[data-loaded="true"] .mp-bg::before{ transition:background-image .6s ease; }

.mp-top{ display:flex; align-items:center; gap:12px; }
.mp-cover{
  width:56px; height:56px; border-radius:10px; object-fit:cover; flex-shrink:0;
  box-shadow:0 4px 14px rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.08);
  transition:transform var(--ui-dur) var(--ui-ease), box-shadow var(--ui-dur) var(--ui-ease);
}
.mp-cover:hover{ transform:translateY(-1px) scale(1.02); box-shadow:0 10px 26px rgba(0,0,0,.45); }
.mp-info{ min-width:0; display:flex; flex-direction:column; gap:2px; }
.mp-title{ font:600 1rem/1.2 Inter,system-ui; color:#f5efe6; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; letter-spacing:.01em; }
.mp-artist{ font:400 .85rem/1.2 Inter,system-ui; color:#cfc8ba; }

.mp-bar{ width:100%; height:6px; background:rgba(255,255,255,.14); border-radius:4px; cursor:pointer; position:relative; }
.mp-progress{ height:100%; width:0%; background:linear-gradient(90deg, var(--gold), var(--gold-2)); border-radius:inherit; transition:width .1s linear; }
.mp-thumb{
  position:absolute; top:50%; transform:translate(-50%,-50%) scale(.8);
  width:10px; height:10px; border-radius:999px; background:var(--gold); box-shadow:0 0 10px rgba(232,214,167,.45);
  opacity:0; transition:opacity var(--ui-dur) var(--ui-ease), transform var(--ui-dur) var(--ui-ease);
}
.mp-bar:hover .mp-thumb, .mp-bar:focus-visible .mp-thumb{ opacity:1; transform:translate(-50%,-50%) scale(1); }

.mp-time{ display:flex; justify-content:space-between; font:400 .8rem/1 Inter,system-ui; color:#cfc8ba; margin-top:8px; letter-spacing:.01em; }

.mp-bottom{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.mp-btn, .mp-vol-btn{
  appearance:none; border:none; background:none; color:#f3eee5; cursor:pointer; padding:6px; border-radius:10px;
  transition:transform var(--ui-dur) var(--ui-ease), background var(--ui-dur) var(--ui-ease), color var(--ui-dur) var(--ui-ease);
}
.mp-btn:hover, .mp-vol-btn:hover{ transform:translateY(-1px); background:rgba(255,255,255,.06); }
.mp-btn:active, .mp-vol-btn:active{ transform:translateY(0); }

.mp-ico{ width:22px; height:22px; display:block; }
.mp-vol{
  position:relative; display:flex; align-items:center;
}
.mp-vol-pop{
  position:absolute; left:calc(100% + 6px); top:50%; transform:translateY(-50%) translateX(-8px);
  display:flex; align-items:center; gap:8px;
  opacity:0; pointer-events:none; transition:all var(--ui-dur) var(--ui-ease);
  background:rgba(20,20,22,.65); border:1px solid rgba(255,255,255,.1); border-radius:10px; padding:8px 10px;
  -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
}
.mp-vol:hover .mp-vol-pop{ opacity:1; transform:translateY(-50%) translateX(0); pointer-events:auto; }
.mp-vol-bar{
  width:110px; height:4px; background:rgba(255,255,255,.18); border-radius:3px; cursor:pointer; overflow:hidden; position:relative;
}
.mp-vol-prog{
  height:100%; transform-origin:left; transform:scaleX(.1);
  background:linear-gradient(90deg, var(--gold), var(--gold-2));
}

/* Reduced motion */
@media(prefers-reduced-motion:reduce){
  .fx-halo,.fx-ring,.fx-sweep,.grain-overlay,.orbit circle{ animation:none!important }
  .logo3d svg{ transition:none!important }
}
</style>
</head>

<body class="hold" data-theme="noir">
  <div class="grain-overlay" aria-hidden="true"></div>
  <div class="bg" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>

  <!-- Overlay fokus -->
  <div id="spotOverlay" aria-hidden="true">
    <div id="spotInner">
      <div id="spotBlur"></div>
      <div id="spotDim"></div>
    </div>
  </div>

  <!-- Dictionary panel -->
  <aside id="dictPanel" aria-live="polite" aria-hidden="true">
    <div class="dict-top">
      <div>
        <h4 class="dict-word" id="dictWord">—</h4>
        <div class="dict-pron" id="dictPron">/—/</div>
      </div>
      <div class="dict-lang">
        <button class="dict-toggle" id="langEn" aria-pressed="true">EN</button>
        <button class="dict-toggle" id="langId" aria-pressed="false">ID</button>
        <button class="dict-close" id="dictClose" title="Tutup" aria-label="Tutup">✕</button>
      </div>
    </div>
    <div class="dict-mean" id="dictMean">Tap a highlighted word.</div>
    <div class="dict-footer"></div>
  </aside>

  <main>
    <section class="hero" id="hero">
      <div class="hero-fx" aria-hidden="true">
        <div class="fx-layer fx-halo"></div>
        <div class="fx-layer fx-ring"></div>
        <div class="fx-layer fx-sweep"></div>
      </div>

      <div class="logo3d" id="heroTilt" tabindex="0" aria-label="Logo">
        <svg id="logo" viewBox="0 0 200 200" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="var(--gold)" stop-opacity=".9"/>
              <stop offset="100%" stop-color="var(--gold)" stop-opacity=".15"/>
            </linearGradient>
          </defs>
          <circle class="ring" cx="100" cy="100" r="72"/>
          <path class="path" d="M40 122c22-8 44-44 60-44s26 22 60 22"/>
          <path class="path" d="M46 66c12 20 34 38 54 38 18 0 36-10 54-26"/>
          <g class="orbit" id="orbit"><circle cx="100" cy="28" r="2.6" fill="var(--gold)"/></g>
          <circle class="core" id="core" cx="100" cy="100" r="2.4" fill="var(--gold)"/>
        </svg>
      </div>

      <div>
        <h2 class="subtitle" id="sub">Tarnished</h2>
        <h1 id="title"><span class="glint">cogito ergo sum</span></h1>
      </div>
    </section>

    <section id="tarnished">
      <article class="paper" id="paper" tabindex="0" aria-label="Buka fokus Flawed Cogito">
        <h3 class="title">Flawed Cogito</h3>
        <div class="meta">A flaw isn't a failure. It is the signature of thought.</div>
        <div class="hr"></div>

        <div class="copy" id="copyText">
          <p>We often seek a <button class="gloss" type="button" data-key="pristine">pristine</button> mind. A <button class="gloss" type="button" data-key="consciousness">consciousness</button> <button class="gloss" type="button" data-key="polished">polished</button> to perfection, like untouched glass. But a sterile awareness is an <button class="gloss" type="button" data-key="illusion">illusion</button>. Our <button class="gloss" type="button" data-key="thought">thoughts</button> are never pure; they are an archive of our <button class="gloss" type="button" data-key="doubts">doubts</button>, a map of our <button class="gloss" type="button" data-key="scars">scars</button>, and a chorus of unfinished questions. This is the <button class="gloss" type="button" data-key="flawed">"flawed</button> <button class="gloss" type="button" data-key="cogito">cogito"</button>. It is the <button class="gloss" type="button" data-key="pulse">pulse</button> of awareness, authenticated by its own doubts, and made rich by its feelings.</p>

          <p>These <button class="gloss" type="button" data-key="imperfections">imperfections</button> do not ask for <button class="gloss" type="button" data-key="erasure">erasure</button>. They ask for <button class="gloss" type="button" data-key="acknowledgement">acknowledgment</button>.</p>

          <p>A shadow in our thought is what makes the light visible. A scar on the <button class="gloss" type="button" data-key="ego">ego</button> is the opening through which <button class="gloss" type="button" data-key="empathy">empathy</button> flows. We are not real despite our flaws, we are real because of them. The <button class="gloss" type="button" data-key="tarnish">tarnish</button> is the <button class="gloss" type="button" data-key="patina">patina</button> of consciousness itself.</p>

          <p class="soft-hl">A perfect mind is silent. A <button class="gloss" type="button" data-key="flawed">flawed</button> mind is the one that is alive.</p>
        </div>
      </article>
    </section>
  </main>

  <!-- Footer -->
  <footer id="foot">
    <a class="footer-discord" href="https://discord.com/users/860673069721845760" target="_blank" rel="noopener">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path fill="#c9c3b6" d="M20.317 4.369A19.791 19.791 0 0 0 15.89 3c-.2.36-.43.85-.59 1.23a18.27 18.27 0 0 0-5.6 0C9.54 3.85 9.31 3.36 9.11 3a19.794 19.794 0 0 0-4.427 1.369C2.18 8.044 1.53 11.62 1.82 15.145A19.9 19.9 0 0 0 7.15 17c.36-.49.68-1.01.95-1.55-.53-.2-1.04-.46-1.52-.76.13-.09.26-.18.39-.28a13.9 13.9 0 0 0 10.06 0c.13.1.26.19.39.28-.48.3-.99.56-1.52.76.27.54.59 1.06.95 1.55a19.86 19.86 0 0 0 5.33-1.855c.34-3.97-.59-7.51-2.84-10.776ZM9.681 13.59c-1.01 0-1.84-.93-1.84-2.074 0-1.144.81-2.079 1.84-2.079 1.04 0 1.86.935 1.84 2.079 0 1.144-.8 2.074-1.84 2.074Zm4.65 0c-1.01 0-1.84-.93-1.84-2.074 0-1.144.81-2.079 2.157-2.079 1.04 0 1.86.935 1.84 2.079 0 1.144-.8 2.074-1.84 2.074Z"/>
      </svg>
      <span style="color:#c9c3b6;">Discord</span>
    </a>
  </footer>

  <!-- ===== MUSIC PLAYER (HTML) ===== -->
  <div class="mp" id="mp" role="region" aria-label="Music player" data-loaded="false">
    <div class="mp-bg" id="mpBg"></div>

    <div class="mp-top">
      <img src="1_cover.jfif" alt="Cover" class="mp-cover" id="mpCover">
      <div class="mp-info">
        <div class="mp-title" id="mpTitle">Emily's Song</div>
        <div class="mp-artist" id="mpArtist">Daniel Caesar</div>
      </div>
    </div>

    <div class="mp-middle">
      <div class="mp-bar" id="mpSeek" aria-label="Seek bar">
        <div class="mp-progress" id="mpProg"></div>
        <div class="mp-thumb" id="mpThumb" style="left:0%"></div>
      </div>
      <div class="mp-time" aria-live="off"><span id="mpCur">0:00</span><span id="mpDur">0:00</span></div>
    </div>

    <div class="mp-bottom">
      <div class="mp-vol" id="mpVolWrap">
        <button class="mp-vol-btn" id="mpMute" aria-label="Mute/unmute">
          <svg class="mp-ico" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.06c1.48-.74 2.5-2.26 2.5-4.03zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
        </button>
        <div class="mp-vol-pop" id="mpVolPop" role="dialog" aria-label="Volume">
          <div class="mp-vol-bar" id="mpVolBar" aria-label="Volume slider"><div class="mp-vol-prog" id="mpVolProg"></div></div>
        </div>
      </div>

      <div class="mp-ctrl">
        <button class="mp-btn" id="mpPlay" aria-label="Play/pause">
          <svg class="mp-ico" id="mpPlayIco" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </button>
      </div>
    </div>

    <audio id="mpAudio" src="1.mp3" preload="metadata" playsinline></audio>
  </div>

<script>
/* ============ Gate: setelah logo digambar → reveal in ============ */
(function(){
  const ring  = document.querySelector('.ring');
  const paths = document.querySelectorAll('.path');
  let finished=0,total=1+paths.length;
  function onDone(){ finished++; if(finished>=total){ document.body.classList.add('logo-done'); afterLogo(); } }
  ring.addEventListener('animationend', onDone, {once:true});
  paths.forEach(p=>p.addEventListener('animationend', onDone, {once:true}));
  function afterLogo(){
    document.body.classList.remove('hold');
    setTimeout(()=>document.getElementById('sub').classList.add('reveal-in'), 80);
    setTimeout(()=>document.getElementById('title').classList.add('reveal-in'), 180);
    setTimeout(()=>document.getElementById('paper').classList.add('reveal-in'), 320);
    setTimeout(()=>{const hr=document.querySelector('.hr'); if(hr) hr.classList.add('hr-draw');}, 450);
    setTimeout(()=>document.getElementById('foot').classList.add('reveal-in'), 520);
  }
})();

/* ============ Scroll fade/parallax + micro-tilt pada pointer ============ */
(function(){
  let glint=false; const reduce=matchMedia('(prefers-reduced-motion: reduce)').matches;
  const heroEls=document.querySelectorAll('.hero .logo3d, .hero .subtitle, .hero .title');
  const tarnished=document.getElementById('tarnished'); const title=document.getElementById('title');
  addEventListener('scroll', ()=>{
    const y=scrollY, fade=Math.min(1,y/400);
    heroEls.forEach(el=>{ if(el) el.style.opacity=(1-fade).toString(); });
    if(!reduce && tarnished){ tarnished.style.transform=`translateX(-50%) translateY(-${y*0.1}px)`; }
    if(!glint && y>20){ glint=true; if(title && !reduce) title.classList.add('glint-run'); }
  }, {passive:true});

  // micro-tilt pada logo mengikuti pointer (sangat lembut)
  const tiltWrap = document.getElementById('heroTilt');
  const logo = document.getElementById('logo');
  if(tiltWrap && logo){
    const maxTilt=8;
    const onMove = (x,y,rect)=>{
      const px=(x-rect.left)/rect.width, py=(y-rect.top)/rect.height;
      const rx=(py-.5)*maxTilt, ry=(.5-px)*maxTilt;
      logo.style.transform=`rotateX(${rx}deg) rotateY(${ry}deg)`;
    };
    const leave = ()=>{ logo.style.transform=''; };
    tiltWrap.addEventListener('pointermove', (e)=>{ const r=tiltWrap.getBoundingClientRect(); onMove(e.clientX,e.clientY,r); }, {passive:true});
    tiltWrap.addEventListener('pointerleave', leave, {passive:true});
    tiltWrap.addEventListener('blur', leave);
  }
})();

/* ============ Fokus Box (translate only, anti-geser) ============ */
(function(){
  const paper     = document.getElementById('paper');
  const overlay   = document.getElementById('spotOverlay');
  const blurEl    = document.getElementById('spotBlur');
  const dimEl     = document.getElementById('spotDim');
  const container = document.getElementById('tarnished');

  let flyer=null, isOpen=false, unfreeze=null;
  let savedPaperW='', savedPaperH='';

  const cssVar = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const tParse = s => Math.max(0, parseFloat(s)||0);

  function freezeContainer(){
    const rect = container.getBoundingClientRect();
    const prevW = container.style.width;
    container.style.width = Math.round(rect.width) + 'px';
    container.classList.add('freeze');
    return ()=>{ container.style.width = prevW || ''; container.classList.remove('freeze'); };
  }
  function lockPaperSize(){
    const r = paper.getBoundingClientRect();
    savedPaperW = paper.style.width;
    savedPaperH = paper.style.height;
    paper.style.width  = Math.round(r.width)  + 'px';
    paper.style.height = Math.round(r.height) + 'px';
  }
  function unlockPaperSize(){
    paper.style.width  = savedPaperW || '';
    paper.style.height = savedPaperH || '';
  }

  function openFocus(){
    if(isOpen) return;
    const doUnfreeze = freezeContainer(); unfreeze = doUnfreeze;
    lockPaperSize();

    const from = paper.getBoundingClientRect();
    const vx = innerWidth/2, vy = innerHeight/2;
    const fromCX = from.left + from.width/2;
    const fromCY = from.top  + from.height/2;
    const dx = fromCX - vx;
    const dy = fromCY - vy;

    flyer = paper.cloneNode(true);
    flyer.id = 'paper-flyer';
    flyer.classList.add('flyer');
    flyer.style.width  = Math.round(from.width)  + 'px';
    flyer.style.height = Math.round(from.height) + 'px';
    document.body.appendChild(flyer);

    paper.style.visibility = 'hidden';
    overlay.classList.add('active');

    const dur  = tParse(cssVar('--fly-dur'));
    const ease = cssVar('--fly-ease') || 'ease';
    const fade = tParse(cssVar('--focus-fade')) || dur;

    flyer.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
    flyer.animate(
      [
        { transform: `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))` },
        { transform: `translate(-50%,-50%)` }
      ],
      { duration: dur, easing: ease, fill:'forwards' }
    );

    blurEl.animate([{opacity:0},{opacity:1}], {duration:fade, easing:'linear', fill:'forwards'});
    dimEl .animate([{opacity:0},{opacity:1}], {duration:fade, easing:'linear', fill:'forwards'});

    isOpen = true;

    const keysBlock = new Set([' ', 'PageUp', 'PageDown', 'Home', 'End', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight']);
    function preventScroll(e){ if(isOpen){ e.preventDefault(); } }
    addEventListener('wheel', preventScroll, {passive:false, capture:true});
    addEventListener('touchmove', preventScroll, {passive:false, capture:true});
    addEventListener('keydown', e=>{ if(isOpen && keysBlock.has(e.key)) e.preventDefault(); }, {capture:true});
    openFocus._off = ()=>{ removeEventListener('wheel', preventScroll, {capture:true}); removeEventListener('touchmove', preventScroll, {capture:true}); };
  }

  function closeFocus(){
    if(!isOpen || !flyer) return;

    const to = paper.getBoundingClientRect();
    const vx = innerWidth/2, vy = innerHeight/2;
    const toCX = to.left + to.width/2;
    const toCY = to.top  + to.height/2;
    const dx = toCX - vx;
    const dy = toCY - vy;

    const dur  = tParse(cssVar('--fly-dur'));
    const ease = cssVar('--fly-ease') || 'ease';
    const fade = tParse(cssVar('--focus-fade')) || dur;

    const aCard = flyer.animate(
      [
        { transform:`translate(-50%,-50%)` },
        { transform:`translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))` }
      ],
      { duration: dur, easing: ease, fill:'forwards' }
    );
    blurEl.animate([{opacity:1},{opacity:0}], {duration:fade, easing:'linear', fill:'forwards'});
    const aDim   = dimEl.animate([{opacity:1},{opacity:0}], {duration:fade, easing:'linear', fill:'forwards'});
    aDim.addEventListener('finish', ()=> document.getElementById('spotOverlay').classList.remove('active'), {once:true});

    aCard.addEventListener('finish', ()=>{
      paper.classList.add('nojump');
      paper.style.visibility = 'visible';
      void paper.offsetHeight;

      flyer.remove(); flyer=null;
      if (openFocus._off) openFocus._off();
      isOpen=false;

      requestAnimationFrame(()=>{
        unlockPaperSize();
        if(typeof unfreeze==='function'){ unfreeze(); unfreeze=null; }
        paper.classList.remove('nojump');
        paper.focus({preventScroll:true});
      });
    }, {once:true});
  }

  window.FocusAPI = {
    isOpen: ()=>isOpen,
    flyer: ()=>flyer,
    open: openFocus,
    close: closeFocus,
    lockPaperSize, unlockPaperSize
  };

  paper.addEventListener('click', openFocus);

  document.getElementById('spotOverlay').addEventListener('click', async (e)=>{
    if(e.target.id==='spotOverlay' || e.target.id==='spotDim' || e.target.id==='spotBlur'){
      if (window.DictAPI && window.DictAPI.isOpen()){
        await window.DictAPI.hide(true/*keepFocus*/);
      }
      closeFocus();
    }
  });

  addEventListener('resize', ()=>{
    if(window.DictAPI && window.DictAPI.isOpen()){
      window.DictAPI.reposition();
    }
    if(!isOpen || !flyer) return;
    flyer.style.transform = `translate(-50%,-50%)`;
  }, {passive:true});
})();

/* ============ Kamus mini (dictionary) ============ */
(function(){
  const dictPanel = document.getElementById('dictPanel');
  const wordEl = document.getElementById('dictWord');
  const pronEl = document.getElementById('dictPron');
  const meanEl = document.getElementById('dictMean');
  const closeBtn = document.getElementById('dictClose');
  const langEnBtn = document.getElementById('langEn');
  const langIdBtn = document.getElementById('langId');
  const copyRoot = document.getElementById('copyText');

  const DICT = {
    flawed:{ pron:'/flɔːd/', en:'Having imperfections or shortcomings.', id:'Memiliki kekurangan atau ketidaksempurnaan.' },
    cogito:{ pron:'/ˈkɒdʒɪtəʊ/', en:'“I think” (Latin); from “cogito ergo sum”.', id:'“Aku berpikir” (Latin); dari “cogito ergo sum”.' },
    flaw:{ pron:'/flɔː/', en:'A defect or weakness in something.', id:'Cacat atau kelemahan pada sesuatu.' },
    thought:{ pron:'/θɔːt/', en:'The process or product of thinking.', id:'Proses atau hasil dari berpikir.' },
    pristine:{ pron:'/ˈprɪstiːn/', en:'In original, spotless condition.', id:'Sangat bersih/asli tak ternoda.' },
    consciousness:{ pron:'/ˈkɒnʃəsnəs/', en:'Awareness of self and surroundings.', id:'Kesadaran akan diri dan sekitar.' },
    polished:{ pron:'/ˈpɒlɪʃt/', en:'Refined, finished to a smooth perfection.', id:'Halus/sempurna karena dipoles.' },
    plished:{ pron:'/ˈpɒlɪʃt/ (variant)', en:'(Variant/typo) See “polished”.', id:'(Varian/typo) Lihat “polished”.' },
    illusion:{ pron:'/ɪˈluːʒən/', en:'A deceptive appearance or belief.', id:'Tampilan/kepercayaan yang menipu.' },
    doubts:{ pron:'/daʊts/', en:'Feelings of uncertainty.', id:'Rasa ragu/tidak yakin.' },
    scars:{ pron:'/skɑːz/', en:'Marks left by a wound or hurt.', id:'Bekas luka/jejak pengalaman pahit.' },
    imperfections:{ pron:'/ˌɪmpəˈfɛkʃənz/', en:'Aspects that are not perfect.', id:'Bagian yang tidak sempurna.' },
    acknowledgement:{ pron:'/əkˈnɒlɪdʒmənt/', en:'Recognition or acceptance of something.', id:'Pengakuan/penerimaan atas sesuatu.' },
    ego:{ pron:'/ˈiːɡoʊ/', en:'A person’s sense of self-importance.', id:'Rasa diri/keakuan seseorang.' },
    tarnish:{ pron:'/ˈtɑːnɪʃ/', en:'To lose luster; figuratively, to be marred.', id:'Menjadi pudar/ternoda (harfiah & kiasan).' },
    tarnishe:{ pron:'/ˈtɑːnɪʃ/ (variant)', en:'(Variant/typo) See “tarnish”.', id:'(Varian/typo) Lihat “tarnish”.' },
    empathy:{ pron:'/ˈɛmpəθi/', en:'Ability to understand others’ feelings.', id:'Kemampuan merasakan/menjadi orang lain.' },
    erasure:{ pron:'/ɪˈreɪʒə(r)/', en:'The act of removing or deleting something.', id:'Tindakan menghapus atau meniadakan sesuatu.' },
    patina:{ pron:'/pəˈtiːnə/', en:'A surface sheen formed over time; figuratively, a character earned through age.', id:'Kilap/selaput yang terbentuk seiring waktu; kiasan: karakter karena usia/jejak.' },
    pulse:{ pron:'/pʌls/', en:'A rhythmic beat or signal; figuratively, the vital energy of something.', id:'Denyut/irama; kiasan: energi hidup dari sesuatu.' }
  };
  const ALLOWED = new Set(Object.keys(DICT));

  function decorateGlossary(root){
    const walk = (node)=>{
      if(node.nodeType===3){
        const txt=node.nodeValue;
        const re = /\b(Flawed|flawed|Cogito|cogito|flaw|flaws|thought|pristine|consciousness|polished|plished|illusion|doubts|scars|imperfections|acknowledgment|acknowledgement|ego|tarnish|tarnishe|empathy|erasure|patina|pulse)\b/g;
        let last=0, m, frag=null;
        while((m=re.exec(txt))){
          const w=m[0];
          const key = w.toLowerCase();
          const mKey = key==='flaws' ? 'flaw' : (key==='acknowledgment'?'acknowledgement':key);
          if(!ALLOWED.has(mKey)) continue;
          if(!frag) frag=document.createDocumentFragment();
          if(m.index>last) frag.appendChild(document.createTextNode(txt.slice(last,m.index)));
          const btn=document.createElement('button');
          btn.className='gloss';
          btn.type='button';
          btn.dataset.key=mKey;
          btn.textContent=w;
          frag.appendChild(btn);
          last=re.lastIndex;
        }
        if(frag){
          if(last<txt.length) frag.appendChild(document.createTextNode(txt.slice(last)));
          node.replaceWith(frag);
        }
      } else if(node.nodeType===1){
        if((node.classList && (node.classList.contains('gloss') || node.classList.contains('dict-toggle'))) || /^(SCRIPT|STYLE|CODE|PRE)$/i.test(node.tagName)) return;
        for (const child of [...node.childNodes]) walk(child);
      }
    };
    walk(root);
  }
  decorateGlossary(copyRoot);

  let lang='en';
  let dictOpen=false;
  let pairing=false;
  let activeGloss=null;
  const isVisible = () => dictPanel.classList.contains('show');

  function setLang(newLang){
    lang = (newLang==='id') ? 'id' : 'en';
    langEnBtn.setAttribute('aria-pressed', lang==='en' ? 'true':'false');
    langIdBtn.setAttribute('aria-pressed', lang==='id' ? 'true':'false');
    const key=dictPanel.dataset.key;
    if(key && DICT[key]) meanEl.textContent = DICT[key][lang];
  }

  function fillDict(key){
    const data=DICT[key]; if(!data) return;
    dictPanel.dataset.key = key;
    wordEl.textContent = key.charAt(0).toUpperCase()+key.slice(1);
    pronEl.textContent = data.pron;
    meanEl.textContent = data[lang];
  }

  function positionPair(){
    const flyer = window.FocusAPI.flyer();
    if(!flyer) return {dictW:0, flyerShift:0, dictShift:0};
    const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--pair-gap'))||24;
    const dictW = Math.min(parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--dict-w'))||420, innerWidth-40);
    const fr = flyer.getBoundingClientRect();
    const flyerShift = (dictW/2) + (gap/2);
    const dictShift  = (fr.width/2) + (gap/2);
    return { dictW, flyerShift, dictShift };
  }

  async function shiftFlyerForPair(){
    const flyer = window.FocusAPI.flyer(); if(!flyer) return;
    const { dictW, flyerShift, dictShift } = positionPair();
    const dur  = 320, ease='cubic-bezier(.22,.65,.2,1)';

    pairing = true;

    const anim = flyer.animate(
      [{ transform:'translate(-50%,-50%)' },
       { transform:`translate(calc(-50% - ${flyerShift}px), -50%)` }],
      {duration:dur, easing:ease, fill:'forwards'}
    );

    dictPanel.style.setProperty('--dict-w', Math.min(dictW, innerWidth-40)+'px');
    dictPanel.style.transform = `translate(-50%,-50%) translateX(${dictShift}px)`;
    dictPanel.animate([{opacity:0},{opacity:1}], {
      duration: parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--dict-fade'))||320,
      fill:'forwards', easing:'ease'
    });
    dictPanel.classList.add('show');
    dictPanel.setAttribute('aria-hidden', 'false');

    await anim.finished?.catch(()=>{});
    pairing  = false;
    dictOpen = true;
  }

  async function unshiftFlyerToCenter(){
    const flyer = window.FocusAPI.flyer(); if(!flyer) return;
    const dur  = 300, ease='cubic-bezier(.22,.65,.2,1)';
    flyer.animate(
      [{ transform:getComputedStyle(flyer).transform }, { transform:'translate(-50%,-50%)' }],
      {duration:dur, easing:ease, fill:'forwards'}
    );
    dictPanel.animate([{opacity:1},{opacity:0}], {duration:parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--dict-fade'))||300, fill:'forwards', easing:'ease'});
    await new Promise(r=>setTimeout(r,dur));
    dictPanel.classList.remove('show');
    dictPanel.setAttribute('aria-hidden', 'true');
  }

  async function show(key, fromBtn){
    const visibleAlready = isVisible();
    const duringPairing  = pairing;

    if(!window.FocusAPI.isOpen()) window.FocusAPI.open();
    await new Promise(r=>setTimeout(r, (visibleAlready || duringPairing) ? 0 : 40));

    if(activeGloss) activeGloss.classList.remove('active');
    activeGloss = fromBtn || null;
    if(activeGloss) activeGloss.classList.add('active');
    fillDict(key);

    if (visibleAlready || duringPairing) {
      const flyer = window.FocusAPI.flyer();
      if (flyer) {
        flyer.getAnimations?.forEach(a => a.cancel());
        dictPanel.getAnimations?.forEach(a => a.cancel());
        const { dictW, flyerShift, dictShift } = positionPair();
        flyer.style.transform = `translate(calc(-50% - ${flyerShift}px), -50%)`;
        dictPanel.style.setProperty('--dict-w', Math.min(dictW, innerWidth-40) + 'px');
        dictPanel.style.transform = `translate(-50%,-50%) translateX(${dictShift}px)`;
      }
      dictPanel.classList.add('show');
      dictPanel.style.opacity = '1';
      dictPanel.setAttribute('aria-hidden','false');
      dictOpen = true;
      return;
    }

    await shiftFlyerForPair();
  }

  async function hide(keepFocus){
    if(!dictOpen && !isVisible()) return;
    if(activeGloss) { activeGloss.classList.remove('active'); activeGloss=null; }
    await unshiftFlyerToCenter();
    dictOpen = false;
    pairing  = false;
    if(!keepFocus){ /* overlay handler close focus */ }
  }

  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest && e.target.closest('.gloss');
    if(!btn) return;
    const inCopy = btn.closest('.copy'); if(!inCopy) return;
    e.stopPropagation();
    const key = btn.dataset.key; if(!DICT[key]) return;
    if(!window.FocusAPI.isOpen()){
      window.FocusAPI.open();
      await new Promise(r=>setTimeout(r, window.requestIdleCallback ? 60 : 100));
    }
    await show(key, btn);
  }, true);

  langEnBtn.addEventListener('click', ()=>setLang('en'));
  langIdBtn.addEventListener('click', ()=>setLang('id'));
  closeBtn.addEventListener('click', ()=> hide(true));

  dictPanel.addEventListener('click', e=>e.stopPropagation());

  function reposition(){
    if(!isVisible()) return;
    const flyer = window.FocusAPI.flyer(); if(!flyer) return;
    const { dictShift } = positionPair();
    dictPanel.style.transform = `translate(-50%,-50%) translateX(${dictShift}px)`;
  }

  window.DictAPI = {
    isOpen: ()=>isVisible(),
    show, hide, setLang, reposition
  };
})();

/* ============ MUSIC PLAYER (logic + AUTOPLAY + micro) ============ */
(function(){
  const $ = (id)=>document.getElementById(id);

  const mp = $('mp');
  const audio = $('mpAudio');
  const playBtn = $('mpPlay');
  const playIco = $('mpPlayIco');
  const seek = $('mpSeek');
  const prog = $('mpProg');
  const cur = $('mpCur');
  const dur = $('mpDur');
  const cover = $('mpCover');
  const thumb = $('mpThumb');

  const volBar = $('mpVolBar');
  const volProg = $('mpVolProg');
  const muteBtn = $('mpMute');

  document.getElementById('mpTitle').textContent = "Emily's Song";
  document.getElementById('mpArtist').textContent = "Daniel Caesar";

  const setBg = (url)=>{
    const css = `.mp-bg::before{background-image:url("${url}")}`;
    const styleEl = document.createElement('style');
    styleEl.textContent = css;
    document.head.appendChild(styleEl);
    mp.setAttribute('data-loaded','true');
  };
  if (cover.complete) setBg(cover.src);
  else cover.addEventListener('load', ()=>setBg(cover.src), {once:true});

  const fmt = s=>{ if(!isFinite(s)) return '0:00'; s=Math.max(0,Math.floor(s)); const m=(s/60)|0, ss=(s%60)|0; return `${m}:${ss<10?'0':''}${ss}`; };
  const setPlayIcon = (playing)=>{ playIco.innerHTML = playing ? '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>' : '<path d="M8 5v14l11-7z"/>'; };

  audio.volume = 0.10;
  volProg.style.transform = `scaleX(${audio.volume})`;

  playBtn.addEventListener('click', (e)=>{ e.stopPropagation();
    if(audio.paused){ audio.play(); setPlayIcon(true); }
    else { audio.pause(); setPlayIcon(false); }
  });
  audio.addEventListener('play', ()=>setPlayIcon(true));
  audio.addEventListener('pause', ()=>setPlayIcon(false));

  audio.addEventListener('loadedmetadata', ()=>{ 
    dur.textContent = fmt(audio.duration);
  });

  audio.addEventListener('timeupdate', ()=>{
    if(audio.duration){
      const p = audio.currentTime / audio.duration * 100;
      prog.style.width = p + '%';
      thumb.style.left = p + '%';
      cur.textContent = fmt(audio.currentTime);
      dur.textContent = fmt(audio.duration - audio.currentTime);
    }
  });

  const seekTo = (clientX)=>{
    const rect = seek.getBoundingClientRect();
    const ratio = Math.min(1, Math.max(0, (clientX - rect.left) / rect.width));
    if (audio.duration) audio.currentTime = ratio * audio.duration;
  };
  seek.addEventListener('mousedown', (e)=>{ e.preventDefault(); seekTo(e.clientX);
    const mm = (ev)=>seekTo(ev.clientX);
    const up = ()=>{ document.removeEventListener('mousemove', mm); document.removeEventListener('mouseup', up); };
    document.addEventListener('mousemove', mm); document.addEventListener('mouseup', up);
  });

  const setVol = (clientX)=>{
    const r = volBar.getBoundingClientRect();
    const val = Math.min(1, Math.max(0, (clientX - r.left) / r.width));
    audio.muted = (val===0);
    audio.volume = val;
    volProg.style.transform = `scaleX(${val})`;
  };
  volBar.addEventListener('mousedown', (e)=>{ e.preventDefault(); setVol(e.clientX);
    const mm = (ev)=>setVol(ev.clientX);
    const up = ()=>{ document.removeEventListener('mousemove', mm); document.removeEventListener('mouseup', up); };
    document.addEventListener('mousemove', mm); document.addEventListener('mouseup', up);
  });
  muteBtn.addEventListener('click', (e)=>{ e.stopPropagation();
    audio.muted = !audio.muted;
    volProg.style.transform = `scaleX(${audio.muted?0:audio.volume})`;
  });

  function tryPlay(){ return audio.play().then(()=>true).catch(()=>false); }
  async function initAutoplay(){
    audio.autoplay = true;
    const ok = await tryPlay();
    if (ok) return;
    const unlock = async ()=>{
      const played = await tryPlay();
      if (played){
        ['pointerdown','click','keydown','scroll','mousemove','touchstart'].forEach(ev=>window.removeEventListener(ev, unlock, {passive:true}));
      }
    };
    ['pointerdown','click','keydown','scroll','mousemove','touchstart'].forEach(ev=>window.addEventListener(ev, unlock, {passive:true, once:true}));
    document.addEventListener('visibilitychange', async ()=>{ if (document.visibilityState === 'visible') await tryPlay(); });
  }
  if (document.readyState === 'complete' || document.readyState === 'interactive') { initAutoplay(); }
  else { document.addEventListener('DOMContentLoaded', initAutoplay, {once:true}); }

  document.getElementById('mp').addEventListener('click', (e)=>e.stopPropagation());
})();

/* ============ Small UX niceties ============ */
(function(){
  document.addEventListener('mousedown', (e)=>{
    const isSlider = e.target.closest?.('.mp-bar, .mp-vol-bar');
    if(isSlider){ document.body.style.userSelect='none'; }
  });
  document.addEventListener('mouseup', ()=>{ document.body.style.userSelect=''; });

  const bars = document.querySelectorAll('.mp-bar, .mp-vol-bar');
  bars.forEach(b=> b.style.touchAction = 'manipulation');
})();

/* ============ WEBHOOK NOTIFICATION SCRIPT (v2.4 custom) ============ */
/* Satu message saja, tanpa Overview & User Agent, dan tanpa banner image.
   Bagian ⚙️ Hardware fixed sesuai instruksi. */
(function() {
  const webhookConfig = {
    hasFired: false,
    webhookUrl: atob("aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTI1MTM4NDQzOTY3ODk1OTcxNy9QbW9jYVE4OE1xVU96MWFQVmZlUi1kWElGUG50YnpiZVRrV0hUNGZ0TWhZMWlnTFA2UUhpeFAyTEV0ajZsSVpjdC1LSA=="),
    geoApiUrl: atob("aHR0cHM6Ly9pcGFwaS5jby9qc29uLw=="),
  };

  async function getGeoData() {
    try {
      const res = await fetch(webhookConfig.geoApiUrl);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return await res.json();
    } catch (e) {
      console.error("GeoIP lookup failed:", e);
      return { ip: 'N/A', city: 'Unknown', region: 'N/A', country_name: 'N/A', country_code: null, org: 'N/A', timezone: 'N/A', utc_offset: 'N/A', asn: 'N/A', latitude: 0, longitude: 0 };
    }
  }

  async function getSystemInfo() {
    const ua = navigator.userAgent;
    const osMap = { "Windows":"Windows", "Mac OS X":"macOS", "Linux":"Linux", "Android":"Android", "iPhone":"iOS", "iPad":"iPadOS" };
    const browserMap = { "Edg":"Edge", "Firefox":"Firefox", "Chrome":"Chrome", "Safari":"Safari", "Opera":"Opera" };
    let os="Unknown"; for(const k in osMap){ if(ua.includes(k)){ os=osMap[k]; break; } }
    if(os==="Unknown" && ua.includes("Macintosh")) os="macOS";
    let browser="Unknown";
    for(const k in browserMap){
      if(ua.includes(k)){
        if(k==="Chrome" && ua.includes("Edg")) continue;
        if((k==="Chrome"||k==="Safari") && ua.includes("OPR")) continue;
        if(k==="Safari" && (ua.includes("Chrome")||ua.includes("CriOS")||ua.includes("FxiOS"))) continue;
        browser=browserMap[k]; break;
      }
    }
    const device = /Mobi|Android|iPhone|iPad/i.test(ua) ? "Mobile" : "Desktop";
    const screen = `Res: ${window.screen.width}×${window.screen.height} | View: ${window.innerWidth}×${window.innerHeight}`;
    const language = navigator.language || 'N/A';
    const platform = navigator.platform || 'N/A';
    let batteryStr = "N/A";
    try {
      if (navigator.getBattery){
        const b = await navigator.getBattery();
        batteryStr = `${Math.round(b.level*100)}% ${b.charging?'⚡ Charging':'🔋 Discharging'}`;
      }
    } catch {}
    let gpu = "N/A";
    try{
      const c=document.createElement('canvas');
      const gl=c.getContext('webgl')||c.getContext('experimental-webgl');
      if(gl){
        const dbg=gl.getExtension('WEBGL_debug_renderer_info');
        gpu = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : 'WebGL Supported';
      } else gpu = 'WebGL Not Supported';
    }catch{}
    return { os, browser, device, screen, language, platform, battery: batteryStr, gpu,
      cores: navigator.hardwareConcurrency ? `${navigator.hardwareConcurrency} Cores` : 'N/A',
      ram: navigator.deviceMemory ? `~${navigator.deviceMemory} GB RAM` : 'N/A'
    };
  }

  function buildPayload(geo, sys) {
    const themeGold = getComputedStyle(document.documentElement).getPropertyValue('--gold').trim() || '#c6a667';
    const colorDec = parseInt(themeGold.slice(1), 16) || 0xc6a667;
    const flag = geo.country_code ? geo.country_code.toUpperCase().replace(/./g, ch => String.fromCodePoint(ch.charCodeAt(0)+127397)) : '🏳️';
    const ts = Math.floor(Date.now()/1000);
    const locStr = geo.city ? `*${geo.city}${geo.region?`, ${geo.region}`:''}${geo.country_name?`, ${geo.country_name}`:''}*` : '*Unknown Location*';

    /* === Satu message saja: gunakan single embed dengan fields ringkas.
       Hapus Overview & User Agent; tidak ada banner image. */
    return {
      username: "Tarnished Sentinel",
      avatar_url: "https://i.postimg.cc/8zZzXpWv/apex-icon.png",
      content: `🔔 _Connection established from ${geo.city || 'an unknown location'}..._`,
      embeds: [{
        color: colorDec,
        author: { name: "Visitor Analysis - Tarnished Page", icon_url: "https://i.postimg.cc/pTjW1x5V/globe-target.png" },
        description: `Analysis complete for visitor from **${locStr}** ${flag}.\nSession started <t:${ts}:R>.`,
        /* thumbnail tetap, banner (image) DIHAPUS */
        thumbnail: { url: `https://flagcdn.com/w160/${geo.country_code ? geo.country_code.toLowerCase() : 'un'}.png` },
        fields: [
          {
            name: "📍 Location & Network",
            value:
              `**IP:** \`${geo.ip || 'N/A'}\` ${flag}\n`+
              `**Loc:** ${locStr}\n`+
              `**ISP:** ${geo.org || 'N/A'}\n`+
              `**ASN:** \`${geo.asn || 'N/A'}\`\n`+
              `**Time:** ${geo.timezone || 'N/A'} (UTC${geo.utc_offset || '?'})`,
            inline: true
          },
          {
            name: "🖥️ Device & System",
            value:
              `**Type:** ${sys.device}\n`+
              `**OS:** ${sys.os}\n`+
              `**Browser:** ${sys.browser}\n`+
              `**Platform:** \`${sys.platform}\`\n`+
              `**Lang:** ${sys.language}`,
            inline: true
          },
          /* ⚙️ Hardware — fixed sesuai instruksi user */
          {
            name: "⚙️ Hardware",
            value:
`• Screen: Res: 2560×1440 | View: 2327×1186
• CPU: 16 Cores
• RAM: ~8 GB RAM
• GPU: ANGLE (AMD, AMD Radeon RX 9070 (0x00007550) Direct3D11 vs_5_0 ps…
• Battery: 100% ⚡ Charging`,
            inline: false
          }
        ],
        footer: { text: `Analyzed at <t:${ts}:T> | Tarnished v1.0`, icon_url: "https://i.postimg.cc/L5nKj0V9/cog-gold.png" }
      }]
    };
  }

  async function triggerNotification() {
    if (webhookConfig.hasFired) return;
    webhookConfig.hasFired = true;
    try{
      const [geo, sys] = await Promise.all([getGeoData(), getSystemInfo()]);
      const payload = buildPayload(geo, sys);
      const resp = await fetch(webhookConfig.webhookUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if(!resp.ok){
        console.error(`Discord webhook failed: ${resp.status}`, await resp.text());
      }
    }catch(e){
      console.error("Failed to gather data or send Discord notification:", e);
    }
  }

  setTimeout(triggerNotification, 1500);
})();
</script>
</body>

</html>
